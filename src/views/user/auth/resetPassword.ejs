<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - ChronoMy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/resetPassword.css">

    <style>
        /* Fade-out animation */
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .fade-out {
            animation: fadeOut 0.5s ease-out forwards;
        }
    </style>
</head>

<body>
<div class="reset-password-container">
    <div class="reset-password-card">

        <!-- Heading -->
        <h1 class="reset-password-title">Enter new Password</h1>

        <!-- Server Error -->
        <% if (error) { %>
            <div
                class="alert alert-danger mb-4"
                role="alert"
                id="serverError">
                <%= error %>
            </div>
        <% } %>

        <!-- Reset Password Form -->
        <form id="resetPasswordForm"
              class="reset-password-form"
              method="POST"
              action="/auth/reset-password">

            <!-- New Password -->
            <div class="password-input-group mb-3">
                <input
                    type="password"
                    id="newPassword"
                    name="newPassword"
                    class="form-control reset-password-input"
                    placeholder="Enter new Password"
                    required
                    autocomplete="new-password"
                >
                <span class="password-toggle"
                      onclick="togglePasswordVisibility('newPassword')">üëÅÔ∏è</span>
            </div>

            <!-- Confirm Password -->
            <div class="password-input-group mb-3">
                <input
                    type="password"
                    id="confirmPassword"
                    name="confirmPassword"
                    class="form-control reset-password-input"
                    placeholder="Confirm new password"
                    required
                    autocomplete="new-password"
                >
                <span class="password-toggle"
                      onclick="togglePasswordVisibility('confirmPassword')">üëÅÔ∏è</span>
            </div>

            <!-- Client-side Error -->
            <div id="passwordMatchError" class="alert alert-danger d-none">
                Passwords do not match
            </div>

            <!-- Submit -->
            <button type="submit" class="btn btn-verify w-100">
                Reset Password
            </button>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Toggle password visibility
    function togglePasswordVisibility(fieldId) {
        const field = document.getElementById(fieldId);
        field.type = field.type === 'password' ? 'text' : 'password';
    }

    // ‚úÖ Auto-dismiss SERVER error exactly in 3 seconds
    const serverError = document.getElementById("serverError");
    if (serverError) {
        // Start fade at 2.5s
        setTimeout(() => {
            serverError.classList.add("fade-out");
        }, 2500);

        // Remove at 3s
        setTimeout(() => {
            serverError.remove();
        }, 3000);
    }

    // Password match validation
    document.getElementById('resetPasswordForm').addEventListener('submit', function(e) {
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const errorDiv = document.getElementById('passwordMatchError');

        if (newPassword !== confirmPassword) {
            e.preventDefault();
            errorDiv.classList.remove('d-none');

            // ‚úÖ Auto-dismiss CLIENT error exactly in 3 seconds
            setTimeout(() => {
                errorDiv.classList.add('fade-out');
            }, 1500);

            setTimeout(() => {
                errorDiv.classList.add('d-none');
                errorDiv.classList.remove('fade-out');
            }, 2000);
        } else {
            errorDiv.classList.add('d-none');
        }
    });
</script>

</body>
</html>
